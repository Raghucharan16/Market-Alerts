name: Market Alerts Scraper

on:
  schedule:
    # Runs every 15 minutes from 9:30 AM to 3:30 PM IST (UTC: 4:00 to 10:00)
    # Cron uses UTC. IST is UTC+5:30.
    # 9:30 AM IST = 4:00 AM UTC
    # 3:30 PM IST = 10:00 AM UTC
    - cron: '*/15 4-10 * * 1-5' # Mon-Fri
  workflow_dispatch: # Allow manual trigger

jobs:
  scrape:
    runs-on: ubuntu-latest
    environment: Production
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    - name: Install Dependencies
      run: |
        pip install -r scraper/requirements.txt

    - name: Run Scraper
      env:
        SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
        SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
        EMAIL_USER: ${{ secrets.EMAIL_USER }}
        EMAIL_PASSWORD: ${{ secrets.EMAIL_PASSWORD }}
      run: |
        python scraper/main.py
